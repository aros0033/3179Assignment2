{

    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "vconcat" : [{
        "title": "Health expenditure as % of GSP (2011-2021)",
        "width": 800,
        "height": 330,
        "projection": {
          "type": "equirectangular"
        },
        "layer": [
          {
            "data": {
              "url": "https://raw.githubusercontent.com/aros0033/3179Assignment2/refs/heads/main/js/Australia_map.topojson",
              "format": {
                "type": "topojson",
                "feature": "STE11aAust"
              }
            },   "params": [
              {
                "name": "state_selection",
                "select": {
                  "type": "point",
                  "on": "click",
                  "fields": ["State"],
                  "clear": "true"
                },
                "bind": "legend"
              }
            ],
            "mark": {
              "type": "geoshape",
              "fill": "lightgray",
              "stroke": "white"
            },
            "encoding": {
              "tooltip": {
                "field": "note"
              }
            }
          },
          {
            "data": {
              "url": "./data/AusHealthExp.csv"
            },
            "transform": [
              {
                "lookup": "State",
                "from": {
                  "data": {
                    "url": "https://raw.githubusercontent.com/aros0033/3179Assignment2/refs/heads/main/js/Australia_map.topojson",
                    "format": {
                      "type": "topojson",
                      "feature": "STE11aAust"
                    }
                  },
                  "key": "properties.STATE_NAME"
                },
                "as": "geo"
              },
              {
                "filter": {"param": "time_brush"}
              },
              {"calculate" : "datum.HealthExp / datum.GSP",
              "as" : "HealthExp_GSP"}
            ],
            "layer" : [{
            "mark": {
              "type": "geoshape",
              "stroke": "#fff",
              "strokeWidth": 1
            },
            "encoding": {
              "shape": {
                "field": "geo",
                "type": "geojson"
              },
              "color": {    
                "field": "HealthExp_GSP",
                "type": "quantitative",
                "scale": { "type" :"log"
                },
                "legend": {
                  "title": "Health expenditure as a % GSP",
                  "format": ".2f",
                  "orient": "top-left",
                  "direction": "vertical"
                }
              },
              "tooltip": [
                {"field": "State","type": "nominal","title": "State"},
                {"field": "Year", "type": "temporal", "title" : "Year", "timeUnit" : "year" }, 
                {"field": "HealthExp_GSP", "type": "quantitative", "format": ".3f", "title": "Health expenditure as a % GSP"},
                {"field": "HealthExp", "type": "quantitative", "title" : "Health Expenditure (millions)", "format" : "$,.0f"},
                {"field": "GSP", "type": "quantitative", "title" : "GSP (millions)", "format" : "$,.0f"}
              ]
            }}, {
              "transform": [{
                "window" : [{"op" : "rank", "as" : "ranking"}],
              "sort": [{"field": "HealthExp_GSP","order": "descending"}]}, {"filter" : "datum.ranking == 1"},
              {"calculate": "'In '+ timeFormat(datum.Year, '%Y') + ' ' + datum.State + ' had the highest GSP to health expenditure ratio: ' + format(datum.HealthExp_GSP, '.3f') + ' with a GSP of ' + format(datum.GSP, '$,.0f') + ' million and a health expenditure of ' + format(datum.HealthExp, '$,.0f') + ' million '  ",
              "as" : "text_annotation"}
            ],
            "mark" : {
            "type": "text",
            "align" : "center",
            "size" : 15,
            "dy": 180 
            },
            "encoding": {"text" : {"field" : "text_annotation" }}
            }]
          }
      ]}
    ,
        {  "data" : {
            "url": "./data/AusHealthExp.csv"
        },
        "width": 800,
        "height": 200,
        "params" : [
            {
                "name" : "time_brush",
                "select" : {"type": "interval" , "encodings": ["x"] }
            }
        ],
        "transform": [ 
          {
            "calculate": "datum.HealthExp / datum.GSP",
            "as": "HealthExp_GSP"
          }
        ],
            "mark" : "line",
            "encoding": {
                "x" : {
                    "field": "Year",
                    "type": "temporal",
                    "timeUnit" : "year"
                    
                  },
              "y": {
                "field": "HealthExp_GSP",
                "title" : "Health expenditure as a % of GSP",
                "type": "quantitative"
              },
        "color": {
          "condition": {
            "param": "state_selection",
            "field": "State",
            "type": "nominal",
            "title": "",
            "legend": {
              "orient": "bottom"
            }
          },
          "value": "lightgray"
        
              },
              "tooltip": [
                {"field" : "Year", "type" : "temporal", "timeUnit" : "year"},
                {"field": "State", "type": "nominal"},
                {"field": "HealthExp_GSP", "type": "quantitative", "title" : "Health Expenditure as a % of GSP", "format" : ".3f"},
                {"field": "HealthExp", "type": "quantitative", "title" : "Health Expenditure (millions)", "format" : "$,.0f"},
                {"field": "GSP", "type": "quantitative", "title" : "GSP (millions)", "format" : "$,.0f"}
              ]
            }
        }
        ],  
      "resolve": {
        "legend": {
          "color": "independent"
        },
        "scale": {
          "color": "independent"
        }
      }
}
